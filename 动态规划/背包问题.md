### 零、综述

##### 背包问题的实质



背包问题有两大类，一类是最优化，一类是计数。



背包问题的实质在于：在==多轮决策==中，权衡每一轮决策中==不同选择方案==的==代价和收益==，在不超过给定代价限制的前提下，最大化所有轮决策累计的总收益。

**背包问题 == 多轮决策 + 每轮决策中的不同方案 + 代价收益的矛盾和权衡**



什么是==多轮决策==？

- 对于大多数背包而言，就是我们有多个物品，我们需要依次对每一个物品做出选择。大多数题目而言，决策的顺序其实没有影响，当然有些题需要一些技巧，比如 [P2370 yyy2015c01 的 U 盘](https://www.luogu.com.cn/problem/P2370) 这道题就需要我们先将所有的物品按照体积从小到大排序再遍历。
- 对于分组背包而言，我们是在每一个组内进行选择，每一个组就是一轮决策。



什么是==不同的选择方案==？

- 对01背包而言，每次决策都只有两个选择：挑选当前物品，不挑选当前物品。类似的还有 [P1156 垃圾陷阱](https://www.luogu.com.cn/problem/P1156) 这道题当中的，每一个垃圾是选择吃掉还是不吃掉。
- 对多重背包和完全背包而言，每次决策可以选择当前物品的数量:0，1，2，。。。，一直到无穷大（多重背包）或者该物品的总数（完全背包）。
- 对分组背包而言，每次的决策是选择每一组内的哪一个物品，或者不选择该组内的物品。



什么是==代价和收益==？

- 代价和收益是不可兼得的，选择会获得价值但会消耗代价，不选择会节省代价但是无法获得价值。例如最经典的 01 背包，想要获得重量（收益）就必须要消耗体积（代价），而总共可供使用的花费是有限的。但是有的题当中，代价和收益也不是泾渭分明吗，例如 [P1156 垃圾陷阱](https://www.luogu.com.cn/problem/P1156) 这一道题中，有两个变量——存活时间和高度，这两个变量互为代价和收益。
- 我们当然喜欢体积小而重量大的物品。然而可惜的是，无论我们按照体积小优先选择，还是按照重量大优先选择，都可能造成选出来的物品重量体积比极小。而如果我们按照重量体积比从大到小选择，则可能造成代价空间的浪费。因为我们的选择是离散的（物品），而非连续的（例如沙子）。





##### 背包问题的分类

按背包物品模型分类

1. 01背包
2. 多重背包
3. 完全背包
4. 分组背包
5. 树上背包





按问题形式分类

1. 不超过背包体积的前提下，可以收获的最大重量
2. 恰好填满某个体积的前提下，可以收获的最大重量
3. 最大化利用背包体积，即占用的背包体积最大
4. 给定的物品所能凑出来的体积值
5. 恰好填满某个体积的方案数量
6. 达到给定重量的所需要的最小背包容积



##### 背包问题的代码

不同的背包物品模型会影响枚举的内容和顺序：

- 通用的枚举顺序：先枚举每一轮决策，再枚举代价空间，再枚举每一轮内的选择。
- 对于压缩空间的代码，01背包一定是从大到小枚举空间，多重背包一定是从小到大枚举空间。

不同的问题形式会影响转移方程：

- **事实上转移方程就是对每一轮决策中，不同选择的讨论**



### 一、01背包变形

##### 1. 不超体积最大重量

[P1048 [NOIP2005 普及组] 采药](https://www.luogu.com.cn/problem/P1048)

经典问题，$f[i][j] = max(f[i - 1][j], \ f[i - 1][j - v[i]] + w[i])$。

所有数组初始化为0。

可以压缩空间。核心代码：

```cpp
memset(f, 0, sizeof f);
for (int i = 1; i <= n; i++) {
	for (int j = m; j >= v[i]; j--) {
        f[j] = max(f[j], f[j - v[i]] + w[i]);
    }
}
```





##### 2. 恰好体积最大重量



同01背包，唯一的不同在于在初始化的时候把 $dp$ 数组的所有值全部初始化为 $-\infty$，$f[0] = 0$。

核心代码：

```cpp
fill(f + 1, f + n + 1, -INF);
f[0] = 0;
for (int i = 1; i <= n; i++) {
	for (int j = m; j >= v[i]; j--) {
        f[j] = max(f[j], f[j - v[i]] + w[i]);
    }
}
```



##### 3. 占用最大体积 

第一种做法：

$f[i]$ 记录体积 $i$ 能否被凑出来。

最后求 $f[i] = 1$ 的最大 $i$ 就是答案。

```cpp
f[0] = 1;
for (int i = 1; i <= n; i++) {
    for (int j = m; j >= v[i]; j--) {
        f[j] |= f[j - v[i]];
    }
}
```



第二种做法：

把每个物品的重量设为自身的体积，转换为 01背包。

$f[m]$ 就是答案。

```cpp
memset(f, 0, sizeof f);
for (int i = 1; i <= n; i++) {
	fir (int j = m; j >= v[i]; j--) {
        f[j] = max(f[j], f[j - v[i]] + v[i])
    }
}
```



例题：[P1049 [NOIP2001 普及组] 装箱问题](https://www.luogu.com.cn/problem/P1049)

【题意】

已知：背包容量 $V$，$n$ 个物品各自的体积 $v_i$。

求：背包剩余空间的最小值。

【分析】

这个问题一般有两种做法。

第一种是设

【ac代码】 

https://www.luogu.com.cn/paste/4icmmf6p





##### 4. 占用体积可行值

这个问题本质上和上一个问题”占用最大体积“是完全同一个问题。

==两个做法都和上一个问题一样。==

特别的是第二种做法，我们求出来所有 $f[]$ 值，就是所有可能出现的体积。因为一个体积 $x$ 只要可以被凑出来，那么一定有 $f[x] = x$。



例题：[P2392 kkksc03考前临时抱佛脚](https://www.luogu.com.cn/problem/P2392)

【题意】

本题的“4科”是唬人的，只是同一个算法重复四次可以。

已知：$n$ 个物品各自的体积 $v_i$。

求：把这 $n$ 个物品分成两组，两组当中体积和较大值的最小值。

【ac代码】

https://www.luogu.com.cn/paste/fz6qcp75





##### 5. 占用体积的方案数量

设 $f[i][j]$ 表示前 $i$ 个物品恰好凑够体积 $j$ 的方案数量。

$f[i][j] = f[i - 1][j] + f[i - 1][j - v[i]]$。

可压缩空间。核心代码：

```cpp
f[0] = 1;
for (int i = 1; i <= n; i++) {
    for (int j = m; j >= v[i]; j--) {
        f[j] += f[j - v[i]];
    }
}
```

例题：[P1164 小A点菜](https://www.luogu.com.cn/problem/P1164)

【题意】

已知：背包容量 $V$，$n$ 个物品各自的体积 $v_i$。

求：恰好占满背包容量的方案数量。

【ac代码】 

https://www.luogu.com.cn/paste/t90whzep



##### 6. 重量达标的最小空间

正着求不超过体积的最大重量（经典01背包），再用二分求得 $f[j] \ge target$ 的最小 $j$ 就是答案。

[P1510 精卫填海](https://www.luogu.com.cn/problem/P1510)

【题意】

已知：背包容量 $V$，$n$ 个物品各自的体积 $v_i$ 和重量 $w_i$，目标的重量 $T$。

求：达到目标重量的前提下，花费的最小体积；或者报告无法达到目标重量。

【ac代码】

https://www.luogu.com.cn/paste/gubbxb4s





##### 7. 物品重量上界

[P2370 yyy2015c01 的 U 盘](https://www.luogu.com.cn/problem/P2370)

【题意】

已知：背包容量为 $V$，$n$ 个物品各自的体积 $v_i$ 和重量 $w_i$，目标的重量 $T$。

求：达到目标重量、并且不超过体积 $V$ 的前提下，所挑选的物品的最大值的最小值。

【分析】

可以二分答案，也可以把所有物品按体积排序。

【ac代码（二分答案）】

https://www.luogu.com.cn/paste/2ol0egwi



##### 8. 不选某些物品

[P4141 消失之物](https://www.luogu.com.cn/problem/P4141) 

【题意】

已知：有 $n$ 个物品，每个物品有体积 $v_i$。记 $cnt(i,x)$：除去物品 i 的剩下 $n - 1$ 种物品，装满容积为 $x$ 的背包，有多少种方案。

求：对于所有的 $i \in [1, n],\ x\in [1, m]$，求 $cnt(i,n)$。

【ac代码】

https://www.luogu.com.cn/paste/jz7djnux





##### 练习题

[P1926 小书童——刷题大军](https://www.luogu.com.cn/problem/P1926)  

两个背包问题的组合（重量达标的最小空间 + 裸01背包）



[P1734 最大约数和](https://www.luogu.com.cn/problem/P1734) 

裸01背包，需要一点数论芝士（预处理 $1...n$ 每个数的约数之和）



[P1466 [USACO2.2]集合 Subset Sums](https://www.luogu.com.cn/problem/P1466) 

裸01背包，稍微变个问法





